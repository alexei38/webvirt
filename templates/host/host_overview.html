{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Hosts" %}{% endblock %}
{% block content %}
{% include "left_menu.html" %}
<div class="row-fluid">
    <div class="span10 offset2 content">
      {% include "error.html" %}
      <div class="page-header">
        <h1>Host</h1>
      </div>
      <div class="row">
        <div class="span4">
          <p>Hostname</p>
          <p>Status</p>
          <p>Address</p>
          <p style="height:30px">
          Memory (<span id="memory-used">0</span> / <span id="memory-max">0</span>)
          </p>
          <p>Type connection</p>
          <p>
            <a href ="#HostModal" data-toggle="modal" class="btn btn-success">Edit</a>
            <a href="#HostRemoveModal" data-toggle="modal" class="btn btn-danger">Remove</a>
          </p>
        </div>
        <div class="span5">
          <p><strong>{{ host.name }}</strong></p>
          <p>
          {% if host_info %}
              <span class="text-success">{% trans "Active" %}</span>
          {% else %}
              <span class="text-error">{% trans "No connected" %}</span>
          {% endif %}
          </p>
          <p>{{ host.ip }}</p>

          <script type="text/javascript">
            $(document).ready(function(){
              function updateBar()
              {
                $.getJSON("{% url 'host_get_memory' host.id %}", function(data) {
                  var bar = $('#memory-usage-bar');
                  bar.width(data.percent);
                  $("#memory-usage-text").html(data.percent);
                  $("#memory-used").html(humanFileSize(data.memusage));
                  $("#memory-max").html(humanFileSize(data.allmem));
                });
              }
              updateBar();
              setInterval(function()
              {
                updateBar()
              }, 20000);
            });
          </script>
          <div class="progress">
            <div class="bar" id="memory-usage-bar" style="width: 0%;"></div>
            <span id="memory-usage-text">0%</span>
          </div>

          <p>{{ host.type }}</p>
        </div>
        {% include "host/host_form.html" with modal_header="Update host" %}
        <div style="display: none;" id="HostRemoveModal" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-body">
            <form method="post" action="{% url 'host_delete' host.id %}" name="deleteHost">
              {% csrf_token %}
              <div style="text-align:center">
                  <h3>Are you sure?</h3>
                  <button class="btn" data-dismiss="modal">Cancel</button>
                  <button class="btn btn-danger">Submit</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
</div>
{% endblock %}